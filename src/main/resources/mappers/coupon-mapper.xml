<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="coupon">
	<insert id="insertCoupon">
	
	INSERT INTO COUPON VALUES(COUPON_SEQ.NEXTVAL, DEFAULT, (SELECT (SYSTIMESTAMP + PERIOD) FROM COUPON_MANAGE 
	WHERE IDX = (select idx from coupon_manage where coupon_code = ${couponCode})), 
    (select idx from coupon_manage where coupon_code = ${couponCode}), 
    (select idx from member where username =${username}))
	
	</insert>
	
	<select id="selectCoupon" resultType="CouponReqDto">
	SELECT COUPON.*,
	COUPON_MANAGE.IDX, COUPON_MANAGE.RATE*100 AS RATE, COUPON_MANAGE.NAME,COUPON_MANAGE.STATUS, COUPON_MANAGE.COUPON_CODE
	FROM COUPON JOIN COUPON_MANAGE ON 
	COUPON.COUPON_IDX=COUPON_MANAGE.IDX WHERE COUPON.MEMBER_IDX = #{memberIdx} AND SYSTIMESTAMP BETWEEN  START_DATE AND EXPIRE_DATE
	</select>
	
	
</mapper>
